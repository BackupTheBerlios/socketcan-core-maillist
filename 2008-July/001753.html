<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Again bit time settings
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-core/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20Again%20bit%20time%20settings&In-Reply-To=%3C4887142B.7050800%40eia.be%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001751.html">
   <LINK REL="Next"  HREF="001761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Again bit time settings</H1>
    <B>Kurt Van Dijck</B> 
    <A HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20Again%20bit%20time%20settings&In-Reply-To=%3C4887142B.7050800%40eia.be%3E"
       TITLE="Again bit time settings">kurt.van.dijck at eia.be
       </A><BR>
    <I>Wed Jul 23 13:21:15 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001751.html">Again bit time settings
</A></li>
        <LI>Next message: <A HREF="001761.html">[PATCH 0/4] new interface for setting bit-timing parameters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1753">[ date ]</a>
              <a href="thread.html#1753">[ thread ]</a>
              <a href="subject.html#1753">[ subject ]</a>
              <a href="author.html#1753">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Wolfgang Grandegger wrote:
&gt;<i> Hi Kurt,
</I>&gt;<i> 
</I>&gt;<i> Kurt Van Dijck wrote:
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The bittiming is discussed again. I see a few different approaches, 
</I>&gt;&gt;<i> probably with different goals.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The main problem with a kernel space calculation is that 'it would not 
</I>&gt;&gt;<i> reproduce all CiA recommendations&quot;.
</I>&gt;&gt;<i> The main problem with tables is that they're never complete.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Wolfgang sent a userspace calculation on Juin 18th, that worked 
</I>&gt;&gt;<i> incredible well for me.
</I>&gt;&gt;<i> I'm not sure it reproduces everything correct, but &quot;it works for me&quot;.
</I>&gt;<i> 
</I>&gt;<i> I will produce good bit-timing parameters for most cases, but not all.
</I>Do you have examples. I'm willing to help improving, I find it _the_ way to go.
&gt;<i> 
</I>&gt;&gt;<i> I put this thing in kernel space now, with some modifications
</I>&gt;&gt;<i> (related to sjw, divide tseg1 into prop_seg &amp; phase_seg1).
</I>&gt;&gt;<i> The major improvement for this algorithm is that is incorporates the 
</I>&gt;&gt;<i> sample_pt from the beginning,
</I>&gt;&gt;<i> instead of trying to optimize for bigger prop_seg, &amp; finding that the 
</I>&gt;&gt;<i> sample_pt getting off.
</I>&gt;<i> 
</I>&gt;<i> I have a patch ready as well, but without sample_pt.
</I>I know, and agree, that the sample_pt is mostly not necessary, but I
had the impression that the lack of it, gives higher precedence to the prop_seg.
Not sure, but I found it also usefull for feedback. The kernel will show you
what the sample_pt is.
&gt;<i> 
</I>&gt;&gt;<i> What this patch does:
</I>&gt;&gt;<i> * add a function can_refresh_btr, to be called after raw btr values 
</I>&gt;&gt;<i> changed
</I>&gt;<i> 
</I>&gt;<i> It's more straight-forward to calculate bit-timing parameters when the 
</I>&gt;<i> device is started (ifconfig can0 up).
</I>Yes &amp; No.
Pro (at ifup) is that you avoid unecessary calculations.
Con (at ifup) is that you have immediate feedback on the calculation even before trying
to ifup. You must also save which source the latest btr_xxx values should come from.
&gt;<i> 
</I>&gt;&gt;<i> * add a function can_find_btr, to calculate a set of btr values.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * some defaults in alloc_candev
</I>&gt;&gt;<i> * a lot of sysfs stuff.
</I>&gt;<i> 
</I>&gt;<i> The SYSFS stuff looks interesting. The current implementation needs some 
</I>&gt;<i> improvement and optimizations.
</I>&gt;<i> 
</I>&gt;<i> I will have a closer look a.s.a.p.
</I>&gt;<i> 
</I>&gt;<i> Wolfgang.
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001751.html">Again bit time settings
</A></li>
	<LI>Next message: <A HREF="001761.html">[PATCH 0/4] new interface for setting bit-timing parameters
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1753">[ date ]</a>
              <a href="thread.html#1753">[ thread ]</a>
              <a href="subject.html#1753">[ subject ]</a>
              <a href="author.html#1753">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-core">More information about the Socketcan-core
mailing list</a><br>
</body></html>
