<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> (ATTicket:560142) Re: Comments on at91_can.c
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-core/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20%28ATTicket%3A560142%29%20Re%3A%20Comments%20on%20at91_can.c&In-Reply-To=%3C4A9ED911.5090200%40pengutronix.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002962.html">
   <LINK REL="Next"  HREF="002964.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>(ATTicket:560142) Re: Comments on at91_can.c</H1>
    <B>Marc Kleine-Budde</B> 
    <A HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20%28ATTicket%3A560142%29%20Re%3A%20Comments%20on%20at91_can.c&In-Reply-To=%3C4A9ED911.5090200%40pengutronix.de%3E"
       TITLE="(ATTicket:560142) Re: Comments on at91_can.c">mkl at pengutronix.de
       </A><BR>
    <I>Wed Sep  2 22:44:01 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="002962.html">MSCAN driver
</A></li>
        <LI>Next message: <A HREF="002964.html">[PATCH V2] net-next-2.6:can: add TI CAN (HECC) driver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2963">[ date ]</a>
              <a href="thread.html#2963">[ thread ]</a>
              <a href="subject.html#2963">[ subject ]</a>
              <a href="author.html#2963">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Frederic,

<A HREF="https://lists.berlios.de/mailman/listinfo/socketcan-core">at91 at atmel.com</A> wrote:

&gt;<i> I will check with our designers regarding TEC and REC behaviour but
</I>&gt;<i> they are probably reset to 0 when 255 is acheived.
</I>
Hmmm.... the manual says to look at the error counter to get state of
the hardware. And &quot;0&quot; indicates error active, whereas the &quot;bits&quot; say bus
off.

&gt;<i> In your case, maybe also you were in Bus off mode but the 128 bits
</I>&gt;<i> sequence has been performed so you are in Active Mode and in that
</I>&gt;<i> case TEC and REC are relevant.
</I>
How is the 128 bit sequence performed? Does it the at91 do it, or do I
have to look at the other stations. At least I didn't send the 128 bit
on purpose ;)

&gt;<i> That would explain you exit the Bus Off mode safely.
</I>
Is a possible explanation, can I verify somehow that these 128 bits have
been send?

&gt;<i> When a packet has been transmitted from our CAN Controller to its CAN
</I>&gt;<i> transceiver, there is no way to cancel it which to my eyes explain
</I>&gt;<i> the latest test results you observe.
</I>
That can explain why the package is transmitted. Who does handle the
resending, in case no one has ACKed the package on the bus? The bus is
open (alternating not-terminated and terminated) for say minutes. Are
these retransmits handled by the transceiver?

However with this setup I manage to bring the chip into bus off state
and with plugging and unplugging the terminator. The chip even makes
this change from bus off to error active. We've only the at91, no other
stations (so no 128 bits) and the driver doesn't reset the chip. But
still it goes from bus off to active.

cheers, Marc

-- 
Pengutronix e.K.                         | Marc Kleine-Budde           |
Linux Solutions for Science and Industry | Phone: +49-231-2826-924     |
Vertretung West/Dortmund                 | Fax:   +49-5121-206917-5555 |
Amtsgericht Hildesheim, HRA 2686         | <A HREF="http://www.pengutronix.de">http://www.pengutronix.de</A>   |

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 260 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/socketcan-core/attachments/20090902/5395efdd/attachment.pgp">https://lists.berlios.de/pipermail/socketcan-core/attachments/20090902/5395efdd/attachment.pgp</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002962.html">MSCAN driver
</A></li>
	<LI>Next message: <A HREF="002964.html">[PATCH V2] net-next-2.6:can: add TI CAN (HECC) driver
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2963">[ date ]</a>
              <a href="thread.html#2963">[ thread ]</a>
              <a href="subject.html#2963">[ subject ]</a>
              <a href="author.html#2963">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-core">More information about the Socketcan-core
mailing list</a><br>
</body></html>
