<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Again bit time settings
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-core/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20Again%20bit%20time%20settings&In-Reply-To=%3C1216802354.3565.50.camel%40pc-mob-grv-deb%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001769.html">
   <LINK REL="Next"  HREF="001748.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Again bit time settings</H1>
    <B>Vladislav Gribov</B> 
    <A HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20Again%20bit%20time%20settings&In-Reply-To=%3C1216802354.3565.50.camel%40pc-mob-grv-deb%3E"
       TITLE="Again bit time settings">gribov at ixxat.de
       </A><BR>
    <I>Wed Jul 23 10:39:12 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001769.html">Again bit time settings
</A></li>
        <LI>Next message: <A HREF="001748.html">Again bit time settings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1746">[ date ]</a>
              <a href="thread.html#1746">[ thread ]</a>
              <a href="subject.html#1746">[ subject ]</a>
              <a href="author.html#1746">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 2008-07-23 at 10:05 +0200, Wolfgang Grandegger wrote:
&gt;<i> Vladislav Gribov wrote:
</I>&gt;<i> &gt; On Tue, 2008-07-22 at 09:57 +0200, Robert Schwebel wrote:
</I>&gt;<i> &gt;&gt; On Tue, Jul 22, 2008 at 09:47:55AM +0200, Wolfgang Grandegger wrote:
</I>&gt;<i> &gt;&gt;&gt; The user has to set the bit-timing parameters tq, prop_seg, etc. directly.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; Will it make on the fly a new table?
</I>&gt;<i> &gt;&gt;&gt; No. The driver just tries to calculate a reasonable brp and print a
</I>&gt;<i> &gt;&gt;&gt; warning message if there is a bit-rate error.
</I>&gt;<i> &gt;&gt; Which leads us back to my original proposal: why not make it possible to
</I>&gt;<i> &gt;&gt; define the table from userspace? That's what Wolfgang calls &quot;indirect
</I>&gt;<i> &gt;&gt; table&quot;. The user would be able to define a bit-timing parameter set
</I>&gt;<i> &gt;&gt; which is *labled* after the corresponding bitrate (or whatever one might
</I>&gt;<i> &gt;&gt; invent) and is selected via the corresponding bit-time entry.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This is what you have done for MSCAN, correct?
</I>&gt;<i> &gt; I like this approach and this is what I mean when I talk about bit rate 
</I>&gt;<i> &gt; tables.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This approach may be compared with ModeLine option of the xfree86 
</I>&gt;<i> &gt; configuration file. With ModeLine the screen resolution is defined over 
</I>&gt;<i> &gt; some magic numbers (like tw, propseg etc in our case) which are readable only 
</I>&gt;<i> &gt; by expert. And a label is given to the defined screen resolution like 
</I>&gt;<i> &gt; &quot;1024x768&quot;, and this label is just perfect to use by everyone.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; For me the bit timing table shall be defined in the same manner. It is 
</I>&gt;<i> &gt; not a part of driver, it is a part of the configuration. The table is 
</I>&gt;<i> &gt; loaded to the driver from the user space, and may be generated by the 
</I>&gt;<i> &gt; advanced tool or just manually by the expert. Of course for the CAN 
</I>&gt;<i> &gt; controllers like SJA1000 and typical CAN clock like 8, 12, 16, 20, 33 Mhz 
</I>&gt;<i> &gt; we can provide configuration with a driver. And if some user have it 
</I>&gt;<i> &gt; running with 25 Mhz, he just edits configuration file and is not forced to 
</I>&gt;<i> &gt; recompile the driver. And another important point is to provide the definition 
</I>&gt;<i> &gt; of the bit rate in an hardware independent way (I guess we have already 
</I>&gt;<i> &gt; achieved a consensus on that issue).
</I>&gt;<i> 
</I>&gt;<i> I think so.
</I>&gt;<i> 
</I>&gt;<i> &gt; So just like ModeLine: graphic cards from different manufacturer are 
</I>&gt;<i> &gt; configured over are common set of values (hw independent) and to have
</I>&gt;<i> &gt; it easier to handle you just give a label to some setting and do reference
</I>&gt;<i> &gt; by name.
</I>&gt;<i> 
</I>&gt;<i> This needs to be implemented using configfs:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://lxr.linux.no/linux+v2.6.26/Documentation/filesystems/configfs/configfs.txt">http://lxr.linux.no/linux+v2.6.26/Documentation/filesystems/configfs/configfs.txt</A>
</I>&gt;<i> 
</I>
Looks good for me. But I am not an expert in such a stuff. Robert, you
have implemented that mechanism for MSCAN by using ifconfig. What do you
think, is configfs a better way?

&gt;<i> It's clear (to me) that such user-defined tables are for experts. Also 
</I>&gt;<i> without them, the driver should work for most CAN controllers by using a 
</I>&gt;<i> built-in algorithm of tables to determine CIA recommended bit-timing 
</I>&gt;<i> values. Right?
</I>&gt;<i> 
</I>
Almost. I actually think we can avoid using any kernel build-in tables
or calculating functions. We can have general driver for some HW family
(like all devices having SJA1000) and a configuration file/script which
sets CiA bitrate table for the specific HW. Such a configuration script
will fit for all HW using same CAN clock.
You do not have to be an expert for using the bit timing table, but you
may have to be one to edit it and adapt for yourself (like if you what
to have another sampling point as recommended by CiA).

Well, may be the differentiation between &quot;expert&quot; and &quot;not expert&quot;
methods of setting bit rate is not quite correct. I cannot imagine an
average housewife (not expert) playing with SocketCAN to control her
kitchen equipment or garage gate :) If you deal with CAN, you need to
understand what you do and have some basic knowledge about bit timings.

-- 
Mit freundlichen Gr&#252;&#223;en / Kind regards,
Dipl.-Ing. Vladislav Gribov MSc
Development
--------------------------------------------
IXXAT Automation GmbH
Leibnizstr. 15, 88250 Weingarten, Germany
Phone  +49-751-56146-0
Direct +49-751-56146-162
Fax    +49-751-56146-29
mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/socketcan-core">gribov at ixxat.de</A>
<A HREF="http://www.ixxat.de">http://www.ixxat.de</A>
--------------------------------------------
PRIVILEGED AND CONFIDENTIAL.
Any unauthorized use or disclosure
is strictly prohibited.
--------------------------------------------
Sitz der Gesellschaft: Weingarten
Handelsregister Ulm HRB 551905
Gesch&#228;ftsf&#252;hrer:
Christian Schlegel, Sieglinde Etschberger
--------------------------------------------

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001769.html">Again bit time settings
</A></li>
	<LI>Next message: <A HREF="001748.html">Again bit time settings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1746">[ date ]</a>
              <a href="thread.html#1746">[ thread ]</a>
              <a href="subject.html#1746">[ subject ]</a>
              <a href="author.html#1746">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-core">More information about the Socketcan-core
mailing list</a><br>
</body></html>
