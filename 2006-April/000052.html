<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> AW: [Socketcan-core] Timestamps
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-core/2006-April/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20AW%3A%20%5BSocketcan-core%5D%20Timestamps&In-Reply-To=%3C1A41773A5657E74C8F2F7EEC649A70920B50DB%40vwagwox00010.vw.vwg%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000067.html">
   <LINK REL="Next"  HREF="000053.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>AW: [Socketcan-core] Timestamps</H1>
    <B>Thuermann, Urs, Dr. (K-GEFE/I)</B> 
    <A HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20AW%3A%20%5BSocketcan-core%5D%20Timestamps&In-Reply-To=%3C1A41773A5657E74C8F2F7EEC649A70920B50DB%40vwagwox00010.vw.vwg%3E"
       TITLE="AW: [Socketcan-core] Timestamps">urs.thuermann at volkswagen.de
       </A><BR>
    <I>Tue Apr 25 17:01:17 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000067.html">[Socketcan-core] [RFC] Restructured kernel/2.6 subtree
</A></li>
        <LI>Next message: <A HREF="000053.html">AW: [Socketcan-core] Timestamps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52">[ date ]</a>
              <a href="thread.html#52">[ thread ]</a>
              <a href="subject.html#52">[ subject ]</a>
              <a href="author.html#52">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jan wrote:

&gt;<i> The upcoming clocksource infrastructure of the kernel uses
</I>&gt;<i> nanoseconds as base, advanced POSIX time interfaces are
</I>&gt;<i> timespec-based (this has nothing to do with the clock source
</I>&gt;<i> precision). I just want to remind of this fact when designing
</I>&gt;<i> *new* interfaces.
</I>
The point is, with SO_TIMESTAMP we haven't designed a new interface
but reused an existing one (together with the kernel function to
support this socket option).  When the time base in the kernel
changes to struct timespec, I'll be more than happy to use that
for our implementation, too.

I see the problem with having to define a new socket option besides
SO_TIMESTAMP for the new format and keeping the old one for
compatability, which don't like too much.

But your suggestion

&gt;<i> Fine, then we do already agree! I would just suggest thinking
</I>&gt;<i> about additional control options for the clock source (including
</I>&gt;<i> on-can-chip timers) and the timestamp format (timeval/timespec/u64).
</I>&gt;<i> Not all options have to be mandatory for each and every implementation,
</I>&gt;<i> but by defining *optional* extensions we can avoid special workarounds
</I>&gt;<i> when they are needed. What about this argument to SO_TIMESTAMP:
</I>&gt;<i> 
</I>&gt;<i> struct can_timestamp_ctrl {
</I>&gt;<i> 	clockid_t clk_id;
</I>&gt;<i> 	int format;
</I>&gt;<i> };
</I>&gt;<i> 
</I>&gt;<i> clockid_t is POSIX + CLOCK_NONE (to disable it) +
</I>CLOCK_WHAT_EVER_YOU_LIKE.
&gt;<i> Format could be TS_FORMAT_TIMEVAL, TS_FORMAT_TIMESPEC, TS_FORMAT_NS64
</I>&gt;<i> (64 bit nanoseconds), making timeval mandatory (if you like this most).
</I>&gt;<i> [Actually, this generic way could be something also for other driver
</I>interfaces.]

seems quite reasonably, I think.

urs

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000067.html">[Socketcan-core] [RFC] Restructured kernel/2.6 subtree
</A></li>
	<LI>Next message: <A HREF="000053.html">AW: [Socketcan-core] Timestamps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#52">[ date ]</a>
              <a href="thread.html#52">[ thread ]</a>
              <a href="subject.html#52">[ subject ]</a>
              <a href="author.html#52">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-core">More information about the Socketcan-core
mailing list</a><br>
</body></html>
