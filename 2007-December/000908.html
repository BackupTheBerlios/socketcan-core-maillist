<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> RFC: CAN state management
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-core/2007-December/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20RFC%3A%20CAN%20state%20management&In-Reply-To=%3C47547B6D.9030806%40hartkopp.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000903.html">
   <LINK REL="Next"  HREF="000910.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>RFC: CAN state management</H1>
    <B>Oliver Hartkopp</B> 
    <A HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20RFC%3A%20CAN%20state%20management&In-Reply-To=%3C47547B6D.9030806%40hartkopp.net%3E"
       TITLE="RFC: CAN state management">socketcan at hartkopp.net
       </A><BR>
    <I>Mon Dec  3 22:55:57 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000903.html">RFC: CAN state management
</A></li>
        <LI>Next message: <A HREF="000910.html">RFC: CAN state management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#908">[ date ]</a>
              <a href="thread.html#908">[ thread ]</a>
              <a href="subject.html#908">[ subject ]</a>
              <a href="author.html#908">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wolfgang Grandegger wrote:
&gt;<i> Robert Schwebel wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> On Mon, Dec 03, 2007 at 03:14:44PM +0100, Hans-J&#252;rgen Koch wrote:
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;&gt;&gt;<i> I second that code. A common &quot;state&quot; variable is not enough. There
</I>&gt;&gt;&gt;&gt;&gt;<i> might be situations (now or in the future) where a state change
</I>&gt;&gt;&gt;&gt;&gt;<i> doesn't cause an interrupt. We might need to read some register in
</I>&gt;&gt;&gt;&gt;&gt;<i> do_get_state().
</I>&gt;&gt;&gt;&gt;&gt;<i>           
</I>&gt;&gt;&gt;&gt;<i> Yes, I have seen various application regularly polling the CAN state.
</I>&gt;&gt;&gt;&gt;<i> Well, for this purpose SYSFS might not be appropriate.
</I>&gt;&gt;&gt;&gt;<i>         
</I>&gt;&gt;&gt;<i> Even if someone polls the state every 10ms, sysfs overhead should be
</I>&gt;&gt;&gt;<i> negligible. If an application polls much faster, it's probably broken
</I>&gt;&gt;&gt;<i> anyway. At least, it wouldn't be better with proc instead of sysfs.
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> What about the variant we discussed in Nurmberg, which is transporting
</I>&gt;&gt;<i> the state information via sysfs (for polling) *and* via error frames for
</I>&gt;&gt;<i> applications which want to get the information on a per-message base?
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> The latter case is only available if state changes are handled by the
</I>&gt;<i> driver.
</I>&gt;<i>   
</I>
Is not every state change handled by the driver? :-)

The only question is, whether the driver sends error frames for it or not.

Maybe we need to check if the states in the error frame meet the driver
status or if we need to add states to the error frame (or reduce states
in the can_state) ...

Or we introduce a new CAN_ERR_STATECHANGE you can set your error filter
to. Hm - it's not really an error (like CAN_ERR_RESTARTED) but whenever
a statechange is detected by the driver the userspace application might
look into the sysfs to determin the current state without polling.

Comments?

Oliver.



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000903.html">RFC: CAN state management
</A></li>
	<LI>Next message: <A HREF="000910.html">RFC: CAN state management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#908">[ date ]</a>
              <a href="thread.html#908">[ thread ]</a>
              <a href="subject.html#908">[ subject ]</a>
              <a href="author.html#908">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-core">More information about the Socketcan-core
mailing list</a><br>
</body></html>
