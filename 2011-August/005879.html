<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [RFC 5/5] [powerpc] Implement a p1010rdb clock source.
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-core/2011-August/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20%5BRFC%205/5%5D%20%5Bpowerpc%5D%20Implement%20a%20p1010rdb%20clock%20source.&In-Reply-To=%3C4E3FE1B0.9090504%40grandegger.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005876.html">
   <LINK REL="Next"  HREF="005877.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[RFC 5/5] [powerpc] Implement a p1010rdb clock source.</H1>
    <B>Wolfgang Grandegger</B> 
    <A HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20%5BRFC%205/5%5D%20%5Bpowerpc%5D%20Implement%20a%20p1010rdb%20clock%20source.&In-Reply-To=%3C4E3FE1B0.9090504%40grandegger.com%3E"
       TITLE="[RFC 5/5] [powerpc] Implement a p1010rdb clock source.">wg at grandegger.com
       </A><BR>
    <I>Mon Aug  8 15:16:32 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="005876.html">[RFC 5/5] [powerpc] Implement a p1010rdb clock source.
</A></li>
        <LI>Next message: <A HREF="005877.html">[RFC 5/5] [powerpc] Implement a p1010rdb clock source.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5879">[ date ]</a>
              <a href="thread.html#5879">[ thread ]</a>
              <a href="subject.html#5879">[ subject ]</a>
              <a href="author.html#5879">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/08/2011 03:00 PM, Marc Kleine-Budde wrote:
&gt;<i> On 08/08/2011 02:48 PM, Robin Holt wrote:
</I>&gt;&gt;&gt;&gt;<i> OK.  Dug a bit more.  The p1010 built-in clocksource seems to be the
</I>&gt;&gt;&gt;&gt;<i> periphereal clock frequency which is system bus frequency divided
</I>&gt;&gt;&gt;&gt;<i> by 2.  The clock source can not be changed, but the clock divider can
</I>&gt;&gt;&gt;&gt;<i> by freezing the interface and setting the CTRL register.  This appears
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> Which bit(s) in the CTRL register is/are this?
</I>&gt;<i> 
</I>&gt;&gt;<i> PRESDIV bits 24-31.  Documented on the P1010 reference manual section 21.3.3.2.
</I>&gt;<i> 
</I>&gt;<i> We have and use these bits on arm, too. These bits are calculated and
</I>&gt;<i> set by the driver[1]. These bits are touched in freescale's 2.6.35
</I>&gt;<i> version of the flexcan driver, too.
</I>
OK, now it starts making sense. And these bits are set according to
relevant DTS properties, I assume. And the input frequency is derived
from the &quot;clock_freq&quot; property entered by the U-Boot bootloader.

&gt;<i> From my point of view it makes no sense to specify this divider in the
</I>&gt;<i> OF-tree. We just need the frequency of the clock entering the flexcan
</I>&gt;<i> core. Which is, as you say, the system bus freq/2.
</I>&gt;<i> 
</I>&gt;<i> [1]
</I>&gt;<i> <A HREF="http://lxr.linux.no/linux+v3.0.1/drivers/net/can/flexcan.c#L597">http://lxr.linux.no/linux+v3.0.1/drivers/net/can/flexcan.c#L597</A>
</I>
Yep, I just wrote a similar comment in my previous mail.

So, of we want to allow the user to define the clock source and divider,
we should provide an interface for both, ARM and PPC.

Wolfgang.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005876.html">[RFC 5/5] [powerpc] Implement a p1010rdb clock source.
</A></li>
	<LI>Next message: <A HREF="005877.html">[RFC 5/5] [powerpc] Implement a p1010rdb clock source.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5879">[ date ]</a>
              <a href="thread.html#5879">[ thread ]</a>
              <a href="subject.html#5879">[ subject ]</a>
              <a href="author.html#5879">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-core">More information about the Socketcan-core
mailing list</a><br>
</body></html>
