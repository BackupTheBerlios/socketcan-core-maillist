<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> REC and TEC
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-core/2008-November/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20REC%20and%20TEC&In-Reply-To=%3C492569AD.2080605%40volkswagen.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002110.html">
   <LINK REL="Next"  HREF="002112.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>REC and TEC</H1>
    <B>Oliver Hartkopp</B> 
    <A HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20REC%20and%20TEC&In-Reply-To=%3C492569AD.2080605%40volkswagen.de%3E"
       TITLE="REC and TEC">oliver.hartkopp at volkswagen.de
       </A><BR>
    <I>Thu Nov 20 14:44:13 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="002110.html">REC and TEC
</A></li>
        <LI>Next message: <A HREF="002112.html">REC and TEC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2111">[ date ]</a>
              <a href="thread.html#2111">[ thread ]</a>
              <a href="subject.html#2111">[ subject ]</a>
              <a href="author.html#2111">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wolfgang Grandegger wrote:
&gt;<i> Claudio Lanconelli wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> Oliver Hartkopp ha scritto:
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> Full ACK. But what about creating a new hw-independed sysfs entry e.g.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> /sys/class/net/can0/can_link_quality
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> that may provide values from 0 (== bad) .. 100 (== excellent) and is
</I>&gt;&gt;&gt;<i> calculated like this:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> can_link_quality = 100 - (max(txerr, rxerr) * 100 / 255);
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> which is an example for the SJA1000 and may have a different calculation
</I>&gt;&gt;&gt;<i> for unusual CAN HW.
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> Ack
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Reading TXERR and RXERR is not available on all CAN controllers and
</I>&gt;<i> implementing it for just a few makes little sense to me.
</I>&gt;<i>
</I>&gt;<i>   
</I>
I would create a function pointer that's implemented in the controller 
driver. And when this is not set at init-time can_link_quality can 
return -EINVAL or something like that. Or can_link_quality only emerges 
when supported by the driver.

&gt;&gt;&gt;<i> It would be a discussion point left, whether 'can_link_quality' gives ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> - the current value
</I>&gt;&gt;&gt;<i> - the worst (== lowest) value since the last reading of 'can_link_quality'
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> while the latter would be my favourite.
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> I vote for the latter.
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Nevertheless, there is already /sys/class/net/can0/can_state. It seems
</I>&gt;<i> unusual to have a more fine grain (non-portable) error level display in
</I>&gt;<i> the CAN world.
</I>&gt;<i>   
</I>
can_state is pretty good but only gives a feedback, when a (mostly 
persistent) problem exists.

The can_link_quality is some kind of dynamic value that can be used when 
attaching or enabling new nodes or to check the CAN  behaviour in widely 
distrubuted networks with heavy load. It's like the 'WLAN Signal-Meter' 
you have in your Desktop tray, that gives you a feeling of what's going 
on even when your WLAN is still established.

IMHO we should give it a try, if it works and if it's useful - at least 
for CAN monitoring.

Regards,
Oliver

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002110.html">REC and TEC
</A></li>
	<LI>Next message: <A HREF="002112.html">REC and TEC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2111">[ date ]</a>
              <a href="thread.html#2111">[ thread ]</a>
              <a href="subject.html#2111">[ subject ]</a>
              <a href="author.html#2111">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-core">More information about the Socketcan-core
mailing list</a><br>
</body></html>
