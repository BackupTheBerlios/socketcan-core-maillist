<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> mcp251x: endless irq when MERRF while receiving
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-core/2010-July/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20mcp251x%3A%20endless%20irq%20when%20MERRF%20while%20receiving&In-Reply-To=%3CAANLkTi%3DBWMu3OE0REksO%3DOUeKbEi%3DpnevhRhSsjgdwbS%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004474.html">
   <LINK REL="Next"  HREF="004477.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>mcp251x: endless irq when MERRF while receiving</H1>
    <B>Fawad Lateef</B> 
    <A HREF="mailto:socketcan-core%40lists.berlios.de?Subject=Re%3A%20mcp251x%3A%20endless%20irq%20when%20MERRF%20while%20receiving&In-Reply-To=%3CAANLkTi%3DBWMu3OE0REksO%3DOUeKbEi%3DpnevhRhSsjgdwbS%40mail.gmail.com%3E"
       TITLE="mcp251x: endless irq when MERRF while receiving">fawadlateef at gmail.com
       </A><BR>
    <I>Sat Jul 24 19:47:26 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004474.html">mcp251x: endless irq when MERRF while receiving
</A></li>
        <LI>Next message: <A HREF="004477.html">mcp251x: endless irq when MERRF while receiving
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4475">[ date ]</a>
              <a href="thread.html#4475">[ thread ]</a>
              <a href="subject.html#4475">[ subject ]</a>
              <a href="author.html#4475">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Everyone,

Recently I spent long-time in rewriting and testing rx and tx processing for
mcp251x driver (especifically for AT91 and MCP2515) which now use
Asynchronous mode in normal conditions which is fast and if there is some
MERRF error then it switches to slow path which is Synchronous and later
switch back fast/Async path when error condition is removed. Moreover it
does bus recovery through restart-ms if BUS goes offline and this continues
till BUS becomes online. There isn't any sort of hanging in any case.

On Sat, Jul 24, 2010 at 4:14 PM, Alexander Holler &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/socketcan-core">holler at ahsoftware.de</A>&gt;wrote:

&gt;<i> Am 24.07.2010 17:01, schrieb Alexander Holler:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  That doesn't help. The irq isn't trigger by MERR but the loop in the IRQ
</I>&gt;&gt;<i> will not be left if that bit is set. Clearing the bit doesn't help,
</I>&gt;&gt;<i> either clearing it doesn't work, or the bit will get set again almost
</I>&gt;&gt;<i> right after it was cleared.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The datasheet says
</I>&gt;<i>
</I>&gt;<i> &quot;Once an interrupt flag is set by the device, the flag can not be reset by
</I>&gt;<i> the MCU until the interrupt condition is removed.&quot;
</I>&gt;<i>
</I>&gt;<i> So it's likely that this bit can' be cleared until the error has gone away
</I>&gt;<i> (even if it isn't used as trigger).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Alexander
</I>&gt;<i>
</I>
At the moment that driver code is very ugly thats why I haven't posted it on
mailing-list yet. On monday I can post it if someone want to test it (kindly
let me know); although I will post cleaned-up patch some time later.

Regards,

Fawad Lateef
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/socketcan-core/attachments/20100724/d31efe7b/attachment.html">https://lists.berlios.de/pipermail/socketcan-core/attachments/20100724/d31efe7b/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004474.html">mcp251x: endless irq when MERRF while receiving
</A></li>
	<LI>Next message: <A HREF="004477.html">mcp251x: endless irq when MERRF while receiving
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4475">[ date ]</a>
              <a href="thread.html#4475">[ thread ]</a>
              <a href="subject.html#4475">[ subject ]</a>
              <a href="author.html#4475">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-core">More information about the Socketcan-core
mailing list</a><br>
</body></html>
